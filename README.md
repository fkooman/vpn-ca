**Summary**: Simple CA intended for use with OpenVPN

**Description**: Simple CA intended for use with OpenVPN written in Go. It is 
much simpler to use than easy-rsa and can be run concurrently.

**License**: MIT

# Introduction

Simple CA intended for use with OpenVPN.

# Why

We started out using [easy-rsa](https://github.com/OpenVPN/easy-rsa) for Let's 
Connect! / eduVPN. It is a shell script wrapped around the OpenSSL command 
line. In theory this can be (very) much cross platform, but in practice it was 
not. Only recent versions fixed some problems on other platforms than Linux.

As part of these fixes they broke backwards compatibility in their 3.x 
releases, which made "in place" upgrades impossible without (manually)
migrating to their new version(s).

We also noticed problems with high volume VPN servers where sometimes the 
easy-rsa certificate database got corrupted because two threads where running 
simultaneously.

This was a good moment to think about ditching easy-rsa and come up with 
something better. Using PHP's OpenSSL binding was out due to its complexity 
while still lacking basic features.

Go has a rich standard library that has all functionality required for creating
a CA, some projects were available doing exactly that as shown above. Using 
those for inspiration, and some borrowing, stripping everything we didn't need 
resulted in a tiny CA that does exactly what we need and nothing more with a
very simple CLI API. Implementing a PHP extension seemed like overkill, so 
we simply use the CLI from PHP.

# Platform Support

We tested on Linux, OpenBSD, macOS and Windows. It works everywhere!

# Build

Use the `Makefile`:

    $ make

Or manually:

    $ go build -o _bin/vpn-ca vpn-ca/main.go

# Usage

Initialize the CA (valid for 5 years) with an RSA key of 3072 bits:

    $ _bin/vpn-ca -init-ca -name "My Root CA"

Generate a server certificate, valid for 1 year:

    $ _bin/vpn-ca -server -name vpn.example.org

Generate a client certificate, valid for 1 year:

    $ _bin/vpn-ca -client -name 12345678

Generate client certificate and specify explicitly when it expires:

    $ _bin/vpn-ca -client -name 12345678 -not-after 2020-12-12T12:12:12+00:00

The `-not-after` flag can be used with both `-client` and `-server`.

If you want to expire a certificate at the exact same time as the CA, you can
use `-not-after CA`.

**NOTE**: if your `-not-after`, or the default of 1 year when not specified, 
extends beyond the lifetime of the CA an error will be thrown! You should 
either reduce the certificate lifetime, or generate a new CA.

There is also the `CA_DIR` environment variable you can set if you do not want 
to use the current directory from which you run the CA command to store the CA, 
server and client certificates, e.g.

    $ CA_DIR=/tmp _bin/vpn-ca -init-ca -name "My Root CA"
    $ CA_DIR=/tmp _bin/vpn-ca -server  -name vpn.example.org
    $ CA_DIR=/tmp _bin/vpn-ca -client  -name 12345678
    
# Algorithms

By default RSA/3072 keys are generated by the CA. You can switch to using ECDSA 
keys with the P-256 / prime256v1 algorithm by setting the `CA_KEY_ALGO` 
environment variable, for example:

    $ CA_KEY_ALGO=ECDSA _bin/vpn-ca -init-ca -name "My NIST Curve CA"
    $ CA_KEY_ALGO=ECDSA _bin/vpn-ca -server -name "www.example.org"
    
The main problem with RSA is that it is (very) slow in generating a new key. On 
high volume servers, or slow systems, e.g. Raspberry Pi, it MAY make sense to 
switch to ECDSA. However, there are some 
[concerns](https://en.wikipedia.org/wiki/Elliptic_Curve_Digital_Signature_Algorithm#Concerns) 
in that it may or may not be worse than RSA.

**NOTE**: there is an `ed25519` branch in the repository that supports EdDSA 
(Ed25519) as well: `CA_KEY_ALGO=EdDSA`, but one needs a relatively modern Go 
version for it, not available through `stretch-backports`.
